# This file describes the settings of the Quanser qube swing-up experiment for the NPDR paper
# This file should remain unchanged if the general experiment set-up doesn't change!
# Hyperparameters should be modified in the hparam_qq-su_<>.yaml file
env_name: qq-su
algo_name: npsi

seed: 101
sbi_subrtn_name: SNPE-C # choose between SNPE-A and SNPE-C

env_hparam:
  dt: 0.004
  max_steps: 2500
  act_delay: 0

policy_name: qq-sub
policy_hparam:
  energy_gain: 0.587
  ref_energy: 0.827

embedding_name: dsemb # as default the `DeltaStepsEmbedding` is set
embedding_hparam:
  downsampling_factor: 20
  len_rollouts: 2500

# ground truth domain-parameters which emulate the parameters of a real environment
dp_real:
  Dr: 0.0000095 # dp_nom["Dr"] * 1.9
  Dp: 0.0000004 # dp_nom["Dp"] * 0.4,
  Rm: 9.24      # dp_nom["Rm"] * 1.1,
  km: 0.0378    # dp_nom["km"] * 0.9,
  Mr: 0.095     # dp_nom["Mr"] * 1.0,
  Mp: 0.0252    # dp_nom["Mp"] * 1.05,
  Lr: 0.085     # dp_nom["Lr"] * 1.0,
  Lp: 0.12255   # dp_nom["Lp"] * 0.95,
  g: 9.81       # dp_nom["g"] * 1.0
  V_thold_neg: 0
  V_thold_pos: 0
  act_delay: 0
  obs_noise_std-sin_theta: 0.5
  obs_noise_std-cos_theta: 0.5
  obs_noise_std-sin_alpha: 0.5
  obs_noise_std-cos_alpha: 0.5
  obs_noise_std-theta_dot: 0.5
  obs_noise_std-alpha_dot: 0.5

# flag which determines if a randomized real environment should be used
randomize_real_dp: False # Currently `True` is not supported by the script

# Prior will be defined in a respective percentage range from the nominal parameters
prior_range:
  Dr: 0.1
  Dp: 0.1
  Rm: 0.2
  km: 0.2
  Mr: 0.1
  Mp: 0.1
  Lr: 0.1
  Lp: 0.1
  g: 0.05
  V_thold_neg: 0.1
  V_thold_pos: 0.1
  act_delay: 0.1
  obs_noise_std-sin_theta: 0.1
  obs_noise_std-cos_theta: 0.1
  obs_noise_std-sin_alpha: 0.1
  obs_noise_std-cos_alpha: 0.1
  obs_noise_std-theta_dot: 0.1
  obs_noise_std-alpha_dot: 0.1

dp_mapping:
  0: Dr
  1: Dp
  2: Rm
  3: km
  4: Mr
  5: Mp
  6: Lr
  7: Lp
  8: g
  9: V_thold_neg
  10: V_thold_pos
  11: act_delay
  12: obs_noise_std-sin_theta
  13: obs_noise_std-cos_theta
  14: obs_noise_std-sin_alpha
  15: obs_noise_std-cos_alpha
  16: obs_noise_std-theta_dot
  17: obs_noise_std-alpha_dot

algo_hparam:
  max_iter: 1
  num_real_rollouts: 2
  num_sim_per_round: 1000
  num_sbi_rounds: 5
  simulation_batch_size: 10
  normalize_posterior: False
  num_eval_samples: 10
  len_segments: 200
#  num_segments: None
  num_workers: 10

  posterior_hparam:
    hidden_features: 50
    model: maf
    num_transforms: 5
    num_components: 10

  subrtn_sbi_sampling_hparam:
    sample_with_mcmc: true

  subrtn_sbi_training_hparam:
    num_atoms: 10
    training_batch_size: 50
    learning_rate: 0.0003
    stop_after_epochs: 20
    validation_fraction: 0.2
    discard_prior_samples: False
    retrain_from_scratch_each_round: False
    show_train_summary: False
    use_combined_loss: False

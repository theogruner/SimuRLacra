# Here you can change the hyperparameter settings for NPDR on the Quanser qube swing-up task.
# currently the hparams are set to replicate the results of the IP paper.

seed: 101
sbi_subrtn_name: SNPE-A # choose between SNPE-A and SNPE-C

# flag which determines if a randomized real environment should be used
randomize_real_dp: False

# ground truth domain-parameters which emulate the parameters of a sim environment
dp_real:
  Dr: 0.0000095 # dp_nom["Dr"] * 1.9 = 0.0000095
  Dp: 0.0000004 # dp_nom["Dp"] * 0.4 = 0.0000004
  Rm: 9.24      # dp_nom["Rm"] * 1.1 = 9.24
  km: 0.0378    # dp_nom["km"] * 0.9 = 0.0378
  Mr: 0.095     # dp_nom["Mr"] * 1.0 = 0.095
  Mp: 0.0252    # dp_nom["Mp"] * 1.05 = 0.0252
  Lr: 0.085     # dp_nom["Lr"] * 1.0 = 0.085
  Lp: 0.12255   # dp_nom["Lp"] * 0.95 = 0.12255
  g: 9.81       # dp_nom["g"] * 1.0 = 9.81
  V_thold_neg: 0
  V_thold_pos: 0
  act_delay: 0

# set prior
prior:
  low:
  - 0.0000  # dp_nom["Dr"] * 0
  - 0.0000  # dp_nom["Dp"] * 0
  - 6.7200  # dp_nom["Rm"] * 0.8
  - 0.0336  # dp_nom["km"] * 0.8
  - 0.0855  # dp_nom["Mr"] * 0.9
  - 0.0216  # dp_nom["Mp"] * 0.9
  - 0.0765  # dp_nom["Lr"] * 0.9
  - 0.1161  # dp_nom["Lp"] * 0.9
  - 8.8290  # dp_nom["g"] * 0.9
#  - 0.000
#  - 0.000
#  - 0.000
  high:
  - 0.0030  # 2 * 0.0015
  - 0.0010  # 2 * 0.0005
  - 10.080  # dp_nom["Rm"] * 1.2
  - 0.0504  # dp_nom["km"] * 1.2
  - 0.1045  # dp_nom["Mr"] * 1.1
  - 0.0264  # dp_nom["Mp"] * 1.1
  - 0.0935  # dp_nom["Lr"] * 1.1
  - 0.1419  # dp_nom["Lp"] * 1.1
  - 10.791  # dp_nom["g"] * 1.1
#  - 0.000
#  - 0.000
#  - 0.000

# comment out the dp_parameter which should not be learned by NPDR
dp_mapping:
  0: Dr
  1: Dp
  2: Rm
  3: km
  4: Mr
  5: Mp
  6: Lr
  7: Lp
  8: g
#  9: V_thold_neg
#  10: V_thold_pos
#  11: act_delay

embedding_name: bsemb # Choose between `dsemb`, `bsemb`, `dtwemb`, `rnnemb`, `lsemb`
embedding_hparam:
  downsampling_factor: 1

npdr_hparam:
  max_iter: 1
  num_real_rollouts: 1
  num_sim_per_round: 10000
  num_sbi_rounds: 5
  simulation_batch_size: 10
  normalize_posterior: False
  num_eval_samples: 10
  len_segments: 200
#  num_segments: None
  num_workers: 8

posterior_hparam:
  hidden_features: 50
  model: mdn_snpe_a  # For SNPE-C, choose between `maf`, `nsf` and `mdn`. For SNPE-A, only `mdn_snpe_a` is supported
  num_transforms: 5
  num_components: 1

subrtn_sbi_sampling_hparam:
  sample_with_mcmc: true

subrtn_sbi_training_hparam:
  training_batch_size: 50
  learning_rate: 0.0003
  validation_fraction: 0.3
  stop_after_epochs: 20
  retrain_from_scratch_each_round: false
  show_train_summary: false
